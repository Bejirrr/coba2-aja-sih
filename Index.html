<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MoonVeil Style Obfuscator v1.4.5 - Roblox Lua</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Courier New', monospace;
      background: #000;
      color: #0f0;
      padding: 20px;
      margin: 0;
    }
    .container {
      max-width: 900px;
      margin: auto;
      border: 1px solid #0f0;
      padding: 20px;
      border-radius: 8px;
    }
    h1 { text-align: center; text-shadow: 0 0 10px #0f0; margin-bottom: 20px; }
    textarea, pre, input {
      width: 100%;
      background: #111;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 15px;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
      border-radius: 5px;
    }
    textarea { height: 180px; resize: vertical; }
    pre { height: 300px; overflow: auto; white-space: pre-wrap; word-wrap: break-word; }
    button {
      background: #003300;
      color: #0f0;
      border: 1px solid #0f0;
      padding: 12px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 16px;
    }
    button:hover { background: #004400; }
    .status { text-align: center; font-size: 14px; margin: 10px 0; color: #0f0; }
    label { color: #0f0; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>MOONVEIL OBFUSCATOR v1.4.5 STYLE [ROBLOX LUA]</h1>
    <p class="status" id="status">Status: Siap (MoonVeil Mode)</p>

    <label><strong>Script Lua Asli:</strong></label>
    <textarea id="input" placeholder="-- Contoh\nprint('Hello, MoonVeil!')\nwait(1)\nprint('Protected!')"></textarea>

    <label><strong>Watermark (Opsional):</strong></label>
    <input type="text" id="watermark" placeholder="Your Discord/Server" value="Protected by MoonVeil Style">

    <button id="obfuscateBtn">OBFUSCATE (MoonVeil Style)</button>

    <label><strong>Hasil Obfuscated:</strong></label>
    <pre id="output">-- Output MoonVeil-style akan muncul di sini...</pre>

    <button id="copyBtn">COPY HASIL</button>
  </div>

  <script>
    // === MOONVEIL-STYLE UTILS ===
    const $ = (id) => document.getElementById(id);
    const status = $('status');
    const input = $('input');
    const output = $('output');
    const watermarkInput = $('watermark');

    function setStatus(msg) {
      status.textContent = 'Status: ' + msg;
    }

    function bxorEncrypt(str, key) {
      let result = '';
      for (let i = 0; i < str.length; i++) {
        result += String.fromCharCode(str.charCodeAt(i) ^ (key.charCodeAt(i % key.length) & 0xFF));
      }
      return btoa(result).replace(/=/g, '').replace(/\+/g, '-').replace(/\//g, '_');
    }

    function randomVar(prefix = '') {
      const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let v = prefix || '_mv_';
      for (let i = 0; i < 2 + Math.floor(Math.random() * 4); i++) v += chars[Math.floor(Math.random() * chars.length)];
      return v;
    }

    function generateLocals(count = 40) {
      let locals = [];
      for (let i = 0; i < count; i++) {
        locals.push(randomVar());
      }
      return locals.join(',');
    }

    function injectJunk(code) {
      const junks = [
        'local _ = math.random(10000,999999)',
        'string.rep("a", math.random(5,20))',
        'for _=1,math.random(3,10) do end',
        'task.wait(math.random()/1000)',
        'local __ = os.clock()'
      ];
      const lines = code.split('\n');
      const result = [];
      let junkCount = 0;
      for (let line of lines) {
        result.push(line.trim());
        if (Math.random() < 0.35 && junkCount < 30) {
          result.push(junks[Math.floor(Math.random() * junks.length)]);
          junkCount++;
        }
      }
      return result.join(';');
    }

    // === ATOB POLYFILL + BXOR DECODE ===
    const atobLua = `local function ${randomVar('atob')}(str) local b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";str=str:gsub("[^%w+/=]","");local pad=str:sub(-2)=="==" and 2 or str:sub(-1)=="=" and 1 or 0;local out={};for i=1,#str,4 do local a=b64:find(str:sub(i,i))-1;local b=b64:find(str:sub(i+1,i+1))-1;local c=b64:find(str:sub(i+2,i+2))-1;local d=b64:find(str:sub(i+3,i+3))-1;table.insert(out,bit32.lshift(a,2)+bit32.rshift(b,4));if c>=0 then table.insert(out,bit32.lshift(bit32.band(b,15),4)+bit32.rshift(c,2)) end;if d>=0 then table.insert(out,bit32.lshift(bit32.band(c,3),6)+d) end end;local res="";for i=1,#out-pad do res=res..string.char(out[i]) end;return res end`;

    // === ANTI-TAMPER (MoonVeil-like) ===
    function antiTamper() {
      const checkVar = randomVar();
      return `local ${checkVar}=function() while true do task.wait(1);local src=debug.getinfo(1).source;if not src:find("moonveil") or #src<100 then while true do end end end end;spawn(${checkVar})`;
    }

    // === MAIN OBFUSCATE (MoonVeil Style) ===
    function obfuscateCode() {
      const raw = input.value.trim();
      if (!raw) {
        alert('Masukkan script Lua dulu!');
        return;
      }

      const watermark = watermarkInput.value.trim() || 'Protected by MoonVeil Style';
      setStatus('Sedang obfuscate MoonVeil-style...');

      let code = raw;

      // 1. STRING ENCRYPTION (BXOR + Base64)
      code = code.replace(/"([^"\\]*(?:\\.[^"\\]*)*)"/g, (m, s) => {
        if (s.includes('\n')) return m;
        const key = Math.random().toString(36).substr(2, 8);
        const enc = bxorEncrypt(s, key);
        const decVar = randomVar('dec');
        return `(function() local ${decVar}=function(s,k)local r=''for i=1,#s do r=r..string.char(bit32.bxor(string.byte(s,i),string.byte(k,(i-1)%#k+1)))end return r end return ${decVar}(${randomVar('atob')}("${enc}":gsub("-","+"):gsub("_","/")..string.rep("=",(-#("${enc}")%4)%3),"${key}") end)()`;
      });

      // 2. VARIABLE RENAME
      const varMap = {};
      code = code.replace(/local\s+([a-zA-Z_][a-zA-Z0-9_]*)/g, (m, name) => {
        if (!varMap[name]) varMap[name] = randomVar();
        return `local ${varMap[name]}`;
      });
      code = code.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g, m => varMap[m] || m);

      // 3. JUNK + SEMI-COLON
      code = injectJunk(code);

      // 4. CONTROL FLOW FLATTEN (While-If State Machine)
      const stateVar = randomVar('state');
      const loopVar = randomVar('loop');
      const initState = Math.floor(Math.random() * 10000) + 10000;
      const endState = Math.floor(Math.random() * 10000) + 40000;
      const midState = Math.floor(Math.random() * 10000) + 30000;
      code = `local ${stateVar}=${initState};while ${stateVar}~=${endState} do if ${stateVar}>=${midState} then if ${stateVar}>${midState} then ${stateVar}=${endState}else ${code} end else end end`;

      // 5. MASSIVE LOCALS + BUILT-INS
      const locals = generateLocals(40);
      const builtIns = `local ${randomVar()},${randomVar()},${randomVar()},${randomVar()},${randomVar()},${randomVar()}=getmetatable,type,pairs,bit32.bxor,string.char,string.byte`;

      // 6. WATERMARK + ANTI-TAMPER + WRAP
      const header = `-- This script was generated using the MoonVeil Obfuscator v1.4.5 [https://moonveil.cc]\n-- ${watermark}`;
      const final = `${header}\n${builtIns};local ${locals};${atobLua};${antiTamper()};${code}`;

      output.textContent = final;
      setStatus('Selesai! Output MoonVeil-style siap copy.');
    }

    // === EVENTS ===
    $('obfuscateBtn').onclick = obfuscateCode;

    $('copyBtn').onclick = () => {
      navigator.clipboard.writeText(output.textContent).then(() => {
        setStatus('Tercopy! Paste ke executor.');
      }).catch(() => {
        const range = document.createRange();
        range.selectNodeContents(output);
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        setStatus('Tercopy (fallback)!');
      });
    };

    // === AUTO-LOAD TEST ===
    window.onload = () => {
      setStatus('MoonVeil v1.4.5 Style aktif. Coba obfuscate!');
    };
  </script>
</body>
</html>
